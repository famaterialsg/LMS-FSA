{% extends 'base.html' %}

{% block title %}Select Questions{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">Select Questions for Quiz</h2>
    <form id="questionForm">
        {% for question in questions %}
        <div class="card mb-3">
            <div class="card-body">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="{{ question.id }}" id="question_{{ question.id }}">
                    <label class="form-check-label" for="question_{{ question.id }}">
                        {{ question.text }}
                    </label>
                </div>
                <div class="mt-2">
                    <strong>Answers:</strong>
                    <ul>
                        {% for answer in question.answers.all %}
                        <li>{{ answer.text }} {% if answer.is_correct %}(Correct){% endif %}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        {% empty %}
        <p class="alert alert-info">No questions available for the selected subject and category.</p>
        {% endfor %}
        <button type="button" class="btn btn-primary mt-3" id="submitQuestions">Submit Selected Questions</button>
    </form>
</div>

<script>
document.getElementById('submitQuestions').addEventListener('click', function() {
    var selectedQuestions = [];
    var checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
    checkboxes.forEach(function(checkbox) {
        selectedQuestions.push(parseInt(checkbox.value));
    });

    window.opener.postMessage({
        type: 'selectedQuestions',
        questions: selectedQuestions
    }, '*');

    window.close();
});
</script>
{% endblock %}
