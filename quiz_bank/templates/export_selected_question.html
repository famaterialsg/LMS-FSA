{% extends 'base.html' %}

{% block title %}Export Questions{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<div class="container mt-4">
  <h2>Export Questions - {{ course.course_code }}</h2>
  <h5>Course Full Name: {{ course.course_name }}</h5>
  <div class="mt-3">
    <p><a href="{% url 'quiz_bank:quiz_bank_course_refresh' course.id %}" class="btn btn-secondary">Back to Quiz Bank - {{ course.course_code }}</a></p>
    <p>
      <span>
        <form method="get">
          Filter by: {{ filter_form.filter_by }}
          <button class="btn btn-primary" type="submit">Filter</button>
          <a class="btn btn-secondary" href="{% url 'quiz_bank:delete_selected_question' course.id %}">Reset Filter</a>
        </form>
      </span>
    </p>
  
  </div>
  {% if question_count > 1 %}
  <h5>Total: {{ question_count }} questions</h5>
  {% else %}
  <h5>Total: {{ question_count }} question</h5>
  {% endif %}

  <div class="mt-3">
    <form method="post">
      {% csrf_token %}
      <table class="table table-striped">
          <thead>
              <tr>
                  <th>#</th>
                  <th>Questions</th>
                  <th>Question Type</th>
                  <th>Answer Options</th>
                  <th>Key</th>
                  <th>Selected</th>
              </tr>
          </thead>
          <tbody>
              {% for question in question_list %}
              <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ question.question }}</td>
                  <td>{{ question.question_type }}</td>
                  <td>
                    {% if question.question_type != 'TEXT' %}
                      <ul>
                          {% for answer in question.answer %}
                          <li>
                              {{ answer }}
                          </li>
                          {% endfor %}
                      </ul>
                    {% else %}
                    N/A
                    {% endif %}
                  </td>
                  <td>
                    <ul>
                      {% for key in question.key %}
                      <li>
                          {{ key }}
                      </li>
                      {% endfor %}
                  </ul>
                  </td>
                  <td>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" name="selected_ids" value="{{ question.id }}">
                    </div>
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>
      <button class="btn btn-primary" type="submit">Export Selected</button>
    </form>
    
    <div class="mt-2">
      <a href="{% url 'quiz_bank:quiz_bank_course_refresh' course.id %}" class="btn btn-secondary">Back to Quiz Bank - {{ course.course_code }}</a>
    </div>
  </div>
</div>
{% endblock %}