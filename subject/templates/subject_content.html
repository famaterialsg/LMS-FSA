{% extends 'base.html' %}
{% load form_filters %}

{% block title %}File Preview{% endblock %}

{% block content %}
{% comment %} <div class="container text-center"> {% endcomment %}
<div class="container-fluid" style="margin-left:1cm; margin-right:1cm">

    <div class="row">
        <!-- Left Column -->
        <div class="col-2">
            <h2 class="text-lg font-semibold mb-4">Subject Content</h2>

            <h3 class="text-lg font-semibold mb-2">Documents</h3>
            {% if documents %}
                <ul class="list-group mb-4">
                    {% for document in documents %}
                        <li class="list-group-item">
                            <a href="{% url 'subject:subject_content' subject.pk %}?file_id={{ document.id }}&file_type=document">{{ document.doc_title }}</a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="mb-4">No documents available for this subject.</p>
            {% endif %}

            <h3 class="text-lg font-semibold mb-2">Videos</h3>
            {% if videos %}
                <ul class="list-group mb-4">
                    {% for video in videos %}
                        <li class="list-group-item">
                            <a href="{% url 'subject:subject_content' subject.pk %}?file_id={{ video.id }}&file_type=video">{{ video.vid_title }}</a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="mb-4">No videos available for this subject.</p>
            {% endif %}

            <a href="{% url 'subject:subject_list' %}" class="btn btn-secondary">Return to Subject List</a>
        </div>

        <!-- Right Column -->
        <div class="col-9">
            <h2 class="text-2xl font-bold mb-4">File Preview</h2>
            {% comment %} <div class="mb-4">
                <a href="{% url 'subject:subject_content_edit' subject.pk %}" class="btn btn-primary">Edit Subject Content</a>
            </div> {% endcomment %}
            <div id="preview-content" class="preview-container border p-3">
                {% if preview_url %}
                    {% if content_type == 'video' %}
                        <video controls class="w-100">
                            <source src="{{ preview_url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    {% elif content_type == 'image' %}
                        <img src="{{ preview_url }}" alt="Image preview" class="img-fluid">
                    {% elif content_type == 'pdf' %}
                        <iframe src="{{ preview_url }}" style="width: 100%; height: 600px;" frameborder="0"></iframe>
                    {% elif content_type == 'document' %}
                        <iframe src="{{ preview_url }}" style="width: 100%; height: 600px;" frameborder="0"></iframe>
{% endif %}
                {% elif download_url %}
                    <p>This file type cannot be previewed. <a href="{{ download_url }}" class="btn btn-primary">Download File</a></p>
                {% else %}
                    <p>Select a file from the left to preview or download it.</p>
                {% endif %}
            </div>
            <div class="text-center">
                <a href="{% url 'subject:subject_content_edit' subject.pk %}" class="btn btn-primary">Edit Subject Content</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const resizer = document.getElementById('resizer');
        const leftSection = document.querySelector('.left-section');
        const rightSection = document.querySelector('.right-section');

        let isResizing = false;

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            document.addEventListener('mousemove', resize);
            document.addEventListener('mouseup', stopResize);
        });

        function resize(e) {
            if (!isResizing) return;
            const containerWidth = document.querySelector('.container').offsetWidth;
            const newLeftWidth = e.clientX;
            const newRightWidth = containerWidth - newLeftWidth;

            leftSection.style.width = `${newLeftWidth}px`;
            rightSection.style.width = `${newRightWidth}px`;
        }

        function stopResize() {
            isResizing = false;
            document.removeEventListener('mousemove', resize);
        }
    });

    function showPreview(url) {
        const previewContent = document.getElementById('preview-content');
        previewContent.innerHTML = `<iframe src="${url}" class="w-full h-full"></iframe>`;
    }
</script>
{% endblock %}
