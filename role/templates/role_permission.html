{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Manage Permissions and Modules for {{ role.role_name }}</h1>

    <form method="post" class="card shadow p-4">
        {% csrf_token %}

        <!-- Permissions Section -->
        <div class="row mb-5">
            <div class="col-md-5">
                <h5>Available Permissions</h5>
                <input type="text" id="searchAvailablePermissions" class="form-control mb-2" placeholder="Search Permissions..." oninput="filterOptions('searchAvailablePermissions', 'availablePermissions')">
                <select id="availablePermissions" class="form-select" size="10" multiple>
                    {% for permission in all_permissions %}
                        {% if permission not in selected_permissions %}
                            <option value="{{ permission.id }}">{{ permission.name }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2 d-flex flex-column align-items-center justify-content-center">
                <button type="button" class="btn btn-outline-primary mb-2" onclick="moveSelected('availablePermissions', 'selectedPermissions')">Add ></button>
                <button type="button" class="btn btn-outline-danger" onclick="moveSelected('selectedPermissions', 'availablePermissions')">< Remove</button>
            </div>

            <div class="col-md-5">
                <h5>Selected Permissions</h5>
                <input type="text" id="searchSelectedPermissions" class="form-control mb-2" placeholder="Search Selected Permissions..." oninput="filterOptions('searchSelectedPermissions', 'selectedPermissions')">
                <select name="permissions" id="selectedPermissions" class="form-select" size="10" multiple>
                    {% for permission in selected_permissions %}
                        <option value="{{ permission.id }}" selected>{{ permission.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Modules Section -->
        <div class="row mb-5">
            <div class="col-md-5">
                <h5>Available Modules</h5>
                <input type="text" id="searchAvailableModules" class="form-control mb-2" placeholder="Search Modules..." oninput="filterOptions('searchAvailableModules', 'availableModules')">
                <select id="availableModules" class="form-select" size="10" multiple>
                    {% for module in all_modules %}
                        {% if module not in selected_modules %}
                            <option value="{{ module.id }}">{{ module.module_name }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2 d-flex flex-column align-items-center justify-content-center">
                <button type="button" class="btn btn-outline-primary mb-2" onclick="moveSelected('availableModules', 'selectedModules')">Add ></button>
                <button type="button" class="btn btn-outline-danger" onclick="moveSelected('selectedModules', 'availableModules')">< Remove</button>
            </div>

            <div class="col-md-5">
                <h5>Selected Modules</h5>
                <input type="text" id="searchSelectedModules" class="form-control mb-2" placeholder="Search Selected Modules..." oninput="filterOptions('searchSelectedModules', 'selectedModules')">
                <select name="modules" id="selectedModules" class="form-select" size="10" multiple>
                    {% for module in selected_modules %}
                        <option value="{{ module.id }}" selected>{{ module.module_name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Save and Back Buttons -->
        <div class="d-flex justify-content-end mt-4">
            <button type="submit" class="btn btn-primary">Save</button>
            <a href="{% url 'role:role_list' %}" class="btn btn-secondary ms-3">Back to Role List</a>
        </div>
    </form>
</div>

<script>
    function moveSelected(sourceId, destinationId) {
        const sourceSelect = document.getElementById(sourceId);
        const destinationSelect = document.getElementById(destinationId);

        Array.from(sourceSelect.selectedOptions).forEach(option => {
            destinationSelect.appendChild(option);
        });
    }

    function filterOptions(inputId, selectId) {
        const filter = document.getElementById(inputId).value.toLowerCase();
        const select = document.getElementById(selectId);
        Array.from(select.options).forEach(option => {
            option.style.display = option.text.toLowerCase().includes(filter) ? 'block' : 'none';
        });
    }
</script>
{% endblock %}
