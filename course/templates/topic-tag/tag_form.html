{% extends 'base.html' %}
{% load widget_tweaks %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">{{ title }}</h2>
    <form method="post">
        {% csrf_token %}

        <!-- Tag fields container -->
        <div id="tag-fields">
            <div class="tag-field mb-3">
                {{ form.name.label_tag }}
                {{ form.name|add_class:"form-control" }}
            </div>

            <div class="mb-3">
                {{ form.topic.label_tag }}
                {{ form.topic|add_class:"form-control" }}
            </div>
        </div>

        <!-- Add another tag button -->
        <button type="button" class="btn btn-outline-primary mb-3" id="add-tag-btn">
            Add Another Tag
        </button>

        <!-- Submit and back buttons -->
        <div class="form-group d-flex align-items-center mt-4">
            <button type="submit" class="btn btn-primary">Save</button>
            <a href="{% url 'course:topic_tag_list' %}" class="btn btn-secondary ms-3">Back to Tag List</a>
        </div>
    </form>
</div>

<script>
// Convert topics from Django into a JavaScript array
const topics = [
    {% for topic in topics %}
        { id: "{{ topic.id }}", name: "{{ topic.name }}" },
    {% endfor %}
];

document.addEventListener('DOMContentLoaded', function() {
    const addTagBtn = document.getElementById('add-tag-btn');
    const tagFieldsContainer = document.getElementById('tag-fields');

    addTagBtn.addEventListener('click', function() {
        const newTagField = document.createElement('div');
        newTagField.classList.add('tag-field', 'mb-3');

        // Create new tag input fields and topic dropdown
        newTagField.innerHTML = `
            <label for="id_name">Tag Name</label>
            <input type="text" name="name" class="form-control" required>

            <label for="id_topic">Topic</label>
            <select name="topic" class="form-control">
                <option value="">Select a Topic</option>
                ${topics.map(topic => `<option value="${topic.id}">${topic.name}</option>`).join('')}
            </select>
        `;

        // Append the new tag input fields to the container
        tagFieldsContainer.appendChild(newTagField);
    });
});
</script>
{% endblock %}
