
{% load get_item %}
    <!-- Sidebar -->
    <style>
        /* Custom active class styling */
        .nav-link.active {
            color: #ffffff !important;
            background-color: #0d6efd !important; /* Dark background for active links */
        }
    </style>

<ul class="nav flex-column">
    {% if user.is_authenticated %}
        {% for group in module_groups %}
            {% if grouped_modules|get_item:group %}
                <li class="nav-item">
                    <a class="nav-link text-light d-flex align-items-center" href="#group-{{ group.id }}" 
                        data-bs-toggle="collapse" role="button"
                        aria-expanded="{% if group.modules.all.0.module_url == active_module_url %}true{% else %}false{% endif %}" 
                        aria-controls="group-{{ group.id }}">
                        <i class="fas fa-caret-right me-2" id="icon-{{ group.id }}"></i>
                        {{ group.group_name }}
                    </a>
                    <ul class="collapse list-unstyled ps-4" id="group-{{ group.id }}">
                        {% for module in grouped_modules|get_item:group %}
                            <li class="nav-item">
                                <a class="nav-link text-light {% if module.module_url == active_module_url %}active{% endif %}" href="{% url module.module_url %}">
                                    <i class="{{ module.icon }}"></i> &nbsp;{{ module.module_name }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </li>
                <hr class="border-secondary my-2">
            {% endif %}
        {% endfor %}
    {% endif %}
</ul>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContentArea = document.getElementById('mainContentArea');
            const toggleButton = document.getElementById('sidebarToggle');
    
            let isSidebarOpen = true; // Sidebar starts open
    
            toggleButton.addEventListener('click', function() {
                if (isSidebarOpen) {
                    // Hide sidebar
                    sidebar.style.transform = 'translateX(-100%)'; // Slide sidebar out
                    mainContentArea.style.marginLeft = '8.33%'; // Adjust main content to slide
                    toggleButton.innerHTML = '<i class="fas fa-arrow-alt-circle-right mt-1" style="font-size: 22px;"></i>'; // Toggle icon
                } else {
                    // Show sidebar
                    sidebar.style.transform = 'translateX(0)'; // Slide sidebar back in
                    mainContentArea.style.marginLeft = '17%'; // Reset main content margin
                    toggleButton.innerHTML = '<i class="fas fa-arrow-alt-circle-left mt-1" style="font-size: 22px;"></i>'; // Toggle icon
                }
                isSidebarOpen = !isSidebarOpen; // Toggle state
            });
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Set active link and expand group based on current URL
            const currentURL = window.location.pathname;
            
            document.querySelectorAll('.collapse').forEach(function (collapseElement) {
                const moduleLinks = collapseElement.querySelectorAll('.nav-link');
                let isActiveGroup = false;
        
                moduleLinks.forEach(function (moduleLink) {
                    if (moduleLink.getAttribute('href') === currentURL) {
                        moduleLink.classList.add('active');
                        isActiveGroup = true;
                    } else {
                        moduleLink.classList.remove('active');
                    }
                });
        
                // Expand group if it contains the active link
                if (isActiveGroup) {
                    collapseElement.classList.add('show');
                }
            });
        });
            </script>
    
    
    
    
    
    
    
    
    
    
    
    
    
    